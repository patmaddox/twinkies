#!/usr/bin/env ruby
require 'rubygems'
require 'ostruct'
begin
  require 'twinkies'
rescue LoadError
  $:.unshift File.dirname(__FILE__) + '/../lib'
  require 'twinkies'
end

username = ARGV.first
config_file = 'twinkies_config.rb'
if ARGV.size == 1
  FileUtils.mkdir(username)
  Dir.chdir(username) do
    File.open(config_file, 'w+') do |file|
      file << "config.username='#{username}'\n"
      file << "config.password='CHANGE_ME'\n"
      file << "config.tweet_db='#{username}_tweets.db'\n"
    end
  end
else
  if File.exists?(config_file)
    config = OpenStruct.new
    eval File.read(config_file)
    config.tweet_db = File.expand_path(config.tweet_db)
    require 'twinkies/server'
    Twinkies::Server.new(config).run
  end
end
